(this["webpackJsonpwebrtc-sigman"]=this["webpackJsonpwebrtc-sigman"]||[]).push([[0],{119:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(9),i=n.n(c),o=(n(83),n(13)),s=(n(84),n(14)),l=n(33),d=n(149),u=n(152),m=n(155),h=n(162),f=n(163),p=n(154),v=n(23),b=n.n(v);function g(e){var t=e.media,n=Object(a.useRef)();return Object(a.useEffect)((function(){t instanceof MediaStream?(n.current.srcObject=t,n.current.play()):n.current.srcObject=null}),[t]),r.a.createElement("video",{ref:n,width:"320",height:"240",autoplay:!0,muted:!0,controls:!0,playsinline:!0}," ")}Object(d.a)((function(e,t){return{root:{maxWidth:345},media:{height:0,paddingTop:"56.25%"},avatarColor:{color:function(e){return e.theme.textColor},backgroundColor:function(e){return e.theme.backgroundColor}},expandOpen:{transform:"rotate(180deg)"}}}));var C=Object(d.a)((function(e,t){return{root:{maxWidth:345},media:{height:0,paddingTop:"56.25%"},avatarColor:{color:function(e){return e.theme.textColor},backgroundColor:function(e){return e.theme.backgroundColor}},expandOpen:{transform:"rotate(180deg)"}}})),k=function(e){var t=e.HandleRemoveRemoteMedia,n=e.content,a=C(n);return r.a.createElement("div",null,r.a.createElement(u.a,{className:a.root},r.a.createElement(h.a,{avatar:r.a.createElement(f.a,{"aria-label":"recipe",className:a.avatarColor},function(e){if("undefined"===typeof e)return"WaitingForResponse";if(e.length<=2)return e;if(e.split(" ").length<2)return e.substr(0,2).toUpperCase();var t=e.match(/\b\w/g)||[];return((t.shift()||"")+(t.pop()||"")).toUpperCase()}(n.name)),title:n.name+"  (YOU)",action:n.media&&n.local?null:r.a.createElement(p.a,{"aria-label":"settings",onClick:function(){return t(n.id)}},r.a.createElement(b.a,null))}),r.a.createElement(m.a,null,r.a.createElement(g,{media:n.media}))))},O=Object(d.a)((function(e,t){return{root:{maxWidth:345},media:{height:0,paddingTop:"56.25%"},avatarColor:{color:function(e){return e.theme.textColor},backgroundColor:function(e){return e.theme.backgroundColor}},expandOpen:{transform:"rotate(180deg)"}}})),S=function(e){var t=e.HandleRemoveRemoteMedia,n=e.content,a=O(n),c=n.outside?n.callerName:n.receiverName;return console.log("here =============>",n,c),r.a.createElement("div",null,r.a.createElement(u.a,{className:a.root},r.a.createElement(h.a,{avatar:r.a.createElement(f.a,{"aria-label":"recipe",className:a.avatarColor},function(e){if("undefined"===typeof e)return"WaitingForResponse";if(e.length<=2)return e;if(e.split(" ").length<2)return e.substr(0,2).toUpperCase();var t=e.match(/\b\w/g)||[];return((t.shift()||"")+(t.pop()||"")).toUpperCase()}(c)),title:c,action:r.a.createElement(p.a,{"aria-label":"settings",onClick:function(){return t(n.id)}},r.a.createElement(b.a,null))}),r.a.createElement(m.a,null,r.a.createElement(g,{media:n.media}))))},j=n(158),w=n(11),E=n(8),R=n.n(E),x=n(15),y=n(156),I=n(157),A=n(160),M=n(159),N=n(161),P=(Object(s.atom)({key:"counterState",default:0}),Object(s.atom)({key:"videoState",default:[]}),Object(s.atom)({key:"LocalMedia",default:[]})),D=Object(s.atom)({key:"RemoteMedia",default:[],dangerouslyAllowMutability:!0}),T=n(24),W=n.n(T);function L(e){return parseInt(e,16)||e}function G(e){return L(e)/255<=.03928?L(e)/255/12.92:Math.pow((L(e)/255+.055)/1.055,2.4)}function F(e){return.2126*G((e=String(e)).substr(1,2))+.7152*G(e.substr(3,2))+.0722*G(e.substr(-2))}function B(e,t){var n=F(e),a=F(t);return(Math.max(n,a)+.05)/(Math.min(n,a)+.05)}var U=function(e){return B(e,"#ffffff")>B(e,"#000000")?"#ffffff":"#000000"},J=function(){var e="#"+Math.floor(16777215*Math.random()).toString(16);return{backgroundColor:e,textColor:U(e)}},H=n(65),Y=n(66),$=n(32),q=n.n($),z=function(){function e(){var t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(H.a)(this,e),this.Id=t.id,this.Name=t.name,this.iceServer={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},this.mediaStream=t.media,this.pc=null,this.debug=n,this.localSdp=null,this.remoteEvent=null,this.remoteStream=null,this.iceCandidates=[],this.iceCandidateComplete=!1,this.setLocalDescription=this.setLocalDescription.bind(this),this.setRemoteDescription=this.setRemoteDescription.bind(this),this.handleCreateOfferError=this.handleCreateOfferError.bind(this),this.handleCreateAnswerError=this.handleCreateAnswerError.bind(this),this.handleRemoteStreamAdded=this.handleRemoteStreamAdded.bind(this),this.handleRemoteStreamAddedWithResolve=this.handleRemoteStreamAddedWithResolve.bind(this),this.handleRemoteStreamRemoved=this.handleRemoteStreamRemoved.bind(this),this.handleIceCandidate=this.handleIceCandidate.bind(this),this.addIceCandidates=this.addIceCandidates.bind(this),this.addStream=this.addStream.bind(this),this.GenerateCall=this.GenerateCall.bind(this),this.GenerateAnswer=this.GenerateAnswer.bind(this)}return Object(Y.a)(e,[{key:"createPeerConnection",value:function(e){var t=this;try{this.pc=new RTCPeerConnection(this.iceServer),this.pc.onicecandidate=function(n){return t.handleIceCandidate(n,e)},this.pc.onaddstream=this.handleRemoteStreamAdded,this.pc.onremovestream=this.handleRemoteStreamRemoved,console.log("Created RTCPeerConnnection")}catch(n){return console.log("Failed to create PeerConnection, exception: "+n.message),void alert("Cannot create RTCPeerConnection object.")}}},{key:"addStream",value:function(){var e=Object(x.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pc.addStream(this.mediaStream);case 2:console.log("added Local stream to the peer connection - localstream - ",this.localStream);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createdOffer",value:function(){var e=Object(x.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("creating offer"),e.next=3,this.pc.createOffer().then(this.setLocalDescription,this.handleCreateOfferError);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createAnswer",value:function(){var e=Object(x.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sending answer to peer."),e.next=3,this.pc.createAnswer().then(this.setLocalDescription,this.handleCreateAnswerError);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setRemoteDescription",value:function(){var e=Object(x.a)(R.a.mark((function e(t){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,this.pc.setRemoteDescription(new RTCSessionDescription(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addIceCandidates",value:function(){var e=Object(x.a)(R.a.mark((function e(t){var n=this;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("receiverSetCallerIceCand  iceCandidateOfCaller-",t),e.next=3,t.forEach((function(e){try{console.log(e),n.pc.addIceCandidate(e)}catch(t){console.error("Error adding received ice candidate",t)}}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.pc.close()}},{key:"handleIceCandidate",value:function(e,t){console.log("icecandidate event: ",e),e.candidate?this.iceCandidates.push(e.candidate):(console.log("End of candidates."),t(!0))}},{key:"handleRemoteStreamAdded",value:function(e){console.log("Remote stream added."),console.log(e),this.remoteEvent=e,this.remoteStream=e.stream}},{key:"handleRemoteStreamAddedWithResolve",value:function(e,t){console.log("Remote stream added."),console.log(e),this.remoteEvent=e,this.remoteStream=e.stream,t(!0)}},{key:"handleRemoteStreamRemoved",value:function(e){console.log("Remote stream removed. Event: ",e)}},{key:"setLocalDescription",value:function(e){this.pc.setLocalDescription(e),this.localSdp=e,console.log("Local- sessionDescription",e)}},{key:"handleCreateOfferError",value:function(e){console.log("createOffer() error: ",e)}},{key:"handleCreateAnswerError",value:function(e){console.log("Failed to create Answer description: "+e.toString())}},{key:"GenerateCall",value:function(){var e=Object(x.a)(R.a.mark((function e(){var t,n,a,r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Promise((function(e,n){t=e,n})),this.createPeerConnection(t),e.next=4,this.addStream();case 4:return e.next=6,this.createdOffer();case 6:return e.next=8,a;case 8:return!0===e.sent&&(n={callId:W.a.v4(),callerId:this.Id,callerName:this.Name,callerSpd:this.localSdp,callerIce:this.iceCandidates}),r=JSON.stringify(Object(w.a)(Object(w.a)({},n),{},{outside:!0})),n=Object(w.a)(Object(w.a)({},n),{},{outside:!1,theme:J()}),e.abrupt("return",[n,q.a.compressToBase64(r)]);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"GenerateAnswer",value:function(){var e=Object(x.a)(R.a.mark((function e(t){var n,a,r,c;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Promise((function(e,t){n=e,t})),this.createPeerConnection(n),e.next=4,this.addStream();case 4:return e.next=6,this.setRemoteDescription(t.callerSpd);case 6:return e.next=8,this.createAnswer();case 8:return e.next=10,r;case 10:return!0===e.sent&&(a=Object(w.a)(Object(w.a)({},t),{},{receiverId:this.Id,receiverName:this.Name,receiverSpd:this.localSdp,receiverIce:this.iceCandidates})),e.next=14,this.addIceCandidates(t.callerIce);case 14:return c=JSON.stringify(a),a=Object(w.a)(Object(w.a)({},a),{},{theme:J()}),e.abrupt("return",[a,q.a.compressToBase64(c)]);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),K=n(67),Q=function(e){e.handleAddRemoteMedia;var t={textField:{width:"90%",marginLeft:"auto",marginRight:"auto",paddingBottom:0,marginTop:0,fontWeight:500,background:"white",color:"white"},input:{color:"white",background:"white"}},n=Object(a.useState)("me"),c=Object(o.a)(n,2),i=c[0],d=c[1],u=Object(a.useState)(""),m=Object(o.a)(u,2),h=m[0],f=m[1],p=Object(a.useState)(""),v=Object(o.a)(p,2),b=v[0],g=v[1],C=Object(s.useRecoilState)(P),k=Object(o.a)(C,2),O=k[0],S=k[1],E=Object(s.useRecoilState)(D),T=Object(o.a)(E,2),L=T[0],G=T[1],F=Object(a.useState)(null),B=Object(o.a)(F,2),U=B[0],H=B[1],Y=function(){var e=Object(x.a)(R.a.mark((function e(){var t;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:!0});case 2:t=e.sent,H(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){U instanceof MediaStream?(U instanceof MediaStream&&U.getTracks().forEach((function(e){return e.stop()})),H(null)):Y()};Object(a.useEffect)((function(){return function(){if(O.length<1){var e={id:W.a.v4(),name:i,theme:J(),media:U,local:!0};S([e])}else{var t=O[0];S([Object(w.a)(Object(w.a)({},t),{},{name:i,media:U})])}}()}),[i,U]);var Q=function(){var e=Object(x.a)(R.a.mark((function e(t){var n,a,r,c,i;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length>0&&t[0].media)){e.next=19;break}if(console.log(t[0].media.constructor.name),"MediaStream"!==t[0].media.constructor.name){e.next=15;break}return n=new z(null,t[0],!1),e.next=6,n.GenerateCall();case 6:a=e.sent,r=Object(o.a)(a,2),c=r[0],i=r[1],G([].concat(Object(l.a)(L),[Object(w.a)(Object(w.a)({},c),{},{RtcPc:n,media:n.remoteStream})])),f(i),console.log(c,i),e.next=17;break;case 15:alert("Click Start and then click generate"),console.log("Click Start and then click generate");case 17:e.next=21;break;case 19:alert("Click Start and then click generate"),console.log("Click Start and then click generate");case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=Object(x.a)(R.a.mark((function e(t,n){var a,r,c,i,s,d,u,m,h;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=JSON.parse(q.a.decompressFromBase64(b)),r=!0,i=new Promise((function(e,t){c=e})),n.forEach(function(){var e=Object(x.a)(R.a.mark((function e(t,o){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.callerId!==a.callerId){e.next=9;break}return r=!1,t.RtcPc.pc.onaddstream=function(e){return t.RtcPc.handleRemoteStreamAddedWithResolve(e,c)},t.RtcPc.setRemoteDescription(a.receiverSpd),t.RtcPc.addIceCandidates(a.receiverIce),e.next=7,i;case 7:e.sent&&(t=Object(w.a)(Object(w.a)({},t),{},{recevierId:a.receiverId,receiverName:a.receiverName,receiverIce:a.receiverIce,receiverSpd:a.receiverSpd,media:t.RtcPc.remoteStream}),n[o]=t);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),!1!==r){e.next=9;break}return e.next=7,i;case 7:e.sent&&G(n);case 9:if(!0!==r){e.next=30;break}if(!(t.length>0&&t[0].media)){e.next=28;break}if("MediaStream"!==t[0].media.constructor.name){e.next=24;break}return s=new z(null,t[0],!1),e.next=15,s.GenerateAnswer(a);case 15:d=e.sent,u=Object(o.a)(d,2),m=u[0],h=u[1],G([].concat(Object(l.a)(n),[Object(w.a)(Object(w.a)({},m),{},{RtcPc:s,media:s.remoteStream})])),f(h),console.log(m,h),e.next=26;break;case 24:alert("Click Start and then click Add"),console.log("Click Start and then click Add");case 26:e.next=30;break;case 28:alert("Click Start and then click Add"),console.log("Click Start and then click Add");case 30:console.log("Final ..  ",n);case 31:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return r.a.createElement(y.a,{position:"static"},r.a.createElement(I.a,null,r.a.createElement(j.a,{justify:"space-between",container:!0,spacing:24},r.a.createElement(j.a,{item:!0,justify:"center",alignItems:"center"},r.a.createElement(M.a,{variant:"contained",onClick:function(){return $()}}," ",U?"Stop":"Start","  "),r.a.createElement(N.a,{id:"name",variant:"filled",label:"Name",className:t.textField,onChange:function(e){return d(e.target.value)},placeholder:"Enter your name",InputProps:{className:t.input}}),r.a.createElement(M.a,{variant:"contained",onClick:function(){Q(O)}},"Generate "),r.a.createElement(A.a,{"aria-label":"minimum height",rowsMin:3,rowsMax:4,placeholder:"",value:h}),r.a.createElement(K.CopyToClipboard,{text:h},r.a.createElement(M.a,{variant:"contained"},"Copy "))),r.a.createElement(j.a,{item:!0,justify:"center",alignItems:"center"},r.a.createElement(A.a,{"aria-label":"minimum height",rowsMin:3,rowsMax:4,placeholder:"Paste here",onChange:function(e){g(e.target.value),console.log(b)},value:b}),r.a.createElement(M.a,{variant:"contained",onClick:function(){console.log(b),V(O,L)}},"Add ")))))};function V(){var e=Object(s.useRecoilState)(D),t=Object(o.a)(e,2),n=t[0],a=t[1],c=Object(s.useRecoilState)(P),i=Object(o.a)(c,2),d=i[0],u=i[1],m=function(e){a((function(t){return t.filter((function(t){return t.id!==e}))}))},h=function(e){u((function(t){return t.filter((function(t){return t.id!==e}))}))};return r.a.createElement("div",null,r.a.createElement(Q,{handleAddRemoteMedia:function(){return a([].concat(Object(l.a)(n),[{id:W.a.v4(),name:"Test Name",theme:J()}]))}}),r.a.createElement("div",{style:{padding:30}},r.a.createElement(j.a,{mt:10,container:!0,spacing:12,direction:"row",justify:"center",alignItems:"center"},r.a.createElement(j.a,{item:!0,xs:16,md:18,direction:"row",justify:"center",alignItems:"center"},r.a.createElement(j.a,{container:!0,direction:"row",justify:"center",alignItems:"center",spacing:12},d.map((function(e){return r.a.createElement(j.a,{key:2,item:!0},r.a.createElement(k,{id:e.id,HandleRemoveRemoteMedia:h,content:e}))})),n.map((function(e){return r.a.createElement(j.a,{key:2,item:!0},r.a.createElement(S,{id:e.callId,HandleRemoveRemoteMedia:m,content:e}))})))))))}var X=function(){var e=r.a.useState(5);return Object(o.a)(e,1)[0],r.a.createElement(s.RecoilRoot,null,r.a.createElement("div",null,r.a.createElement(V,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(X,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},78:function(e,t,n){e.exports=n(119)},83:function(e,t,n){},84:function(e,t,n){}},[[78,1,2]]]);
//# sourceMappingURL=main.956a66af.chunk.js.map